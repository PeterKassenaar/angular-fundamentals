<div class="container">
  <h2 class="my-4">City Management (CRUD-application)</h2>

  <div class="row">
    <!--    ***********************-->
    <!-- Left Column: City List -->
    <!--    ***********************-->
    <div [class]="isPanelVisible() ? 'col-md-6' : 'col-12'">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>My Favorite Cities</h3>
        <button class="btn btn-success" (click)="startNewCity()">+ Add New City</button>
      </div>

      <!--      Loading spinner-->
      @if (isLoading()) {
        <div class="d-flex justify-content-center mt-5">
          <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
        </div>
      } @else {
        <!--        Loading complete, show list of cities-->
        <ul class="list-group">
          @for (city of cities(); track city.id) {
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                (click)="showCityDetails(city)">
              <span>{{ city.name }} ({{ city.province }})</span>
              <div>
                <button class="btn btn-sm btn-outline-primary me-2"
                        (click)="selectCity(city); $event.stopPropagation()">Edit
                </button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteCity(city); $event.stopPropagation()">
                  Delete
                </button>
              </div>
            </li>
          }
        </ul>
      }
    </div>

    <!--    ***********************-->
    <!--    Right Column: Details/Edit Panels -->
    <!--    Only visible if signal isPanelVisible() in app.ts is set to true.-->
    <!--    ***********************-->
    @if (isPanelVisible()) {
      <div class="col-md-6">
        <!-- City Details Panel -->
        @if (isViewingLoading()) {
          <div class="card mt-4 mt-md-0">
            <div class="card-body text-center">
              <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
            </div>
          </div>
        } @else if (viewingCity(); as city) {
          <div class="card mt-4 mt-md-0">
            <div class="card-header">Details for {{ city.name }}</div>
            <div class="card-body">
              <img [src]="'assets/img/' + city.name + '.jpg'" [alt]="city.name" class="img-fluid mb-3">
              <p><strong>ID:</strong> {{ city.id }}</p>
              <p><strong>Province:</strong> {{ city.province }}</p>
              <p><strong>Highlights:</strong> {{ city.highlights }}</p>
            </div>
            <div class="card-footer">
              <button class="btn btn-secondary" (click)="hideDetails()">Hide</button>
            </div>
          </div>
        }

        <!-- Edit/Create Form -->
        @if (editingCity(); as city) {
          <div class="card mt-4 mt-md-0">
            <div class="card-header">{{ 'id' in city ? 'Edit City' : 'Add New City' }}</div>
            <div class="card-body">
              <!--              City Name-->
              <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" id="name" class="form-control" [(ngModel)]="city.name">
              </div>
              <div class="mb-3">
                <!--                City Province-->
                <label for="province" class="form-label">Province</label>
                <input type="text" id="province" class="form-control" [(ngModel)]="city.province">
              </div>
              <div class="mb-3">
                <!--              City Highlights-->
                <label for="hightlights" class="form-label">Hightlights</label>
                <input type="text" id="hightlights" class="form-control" [(ngModel)]="city.highlights">
              </div>
              <button class="btn btn-primary me-2" (click)="saveCity()">Save</button>
              <button class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
